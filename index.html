
<html>
<script src='https://d3js.org/d3.v5.min.js'></script>
<style> circle {fill: lightblue; stroke: black;} 
#tooltip {
  opacity: 0;
  position: absolute;
  text-align: left;
  text-wrap: nowrap;
  padding-left: 3px;
  width: fit-content;
  height: 100px;
  background: white;
  border: solid;
  border-width: 2px;
  border-color: black;
}
</style>

<head>
  <h1>Most Popular Songs on Spotify and Youtube</h1>
</head>
<body onload = "init()">
<button id = "Full" onclick='changeData(-1)'>Full Dataset</button>
<button id = "Top2000" onclick='changeData(2000)'>Top 2000</button>
<div>    </div>
<button id = "Views" onclick='changeData(0,"Views")'>Youtube Views</button>
<button id = "Stream" onclick='changeData(0,"Stream")'>Spotify Streams</button>
<div>
</div>
<button id = "Tempo" onclick='plot("Tempo")'>Tempo</button>
<button id = "Duration" onclick='plot("Duration")'>Duration</button>
<button id = "Intensity" onclick='plot("Intensity")'>Intensity</button>
<button id = "Valence" onclick='plot("Valence")'>Valence</button>
<button id = "Acousticness" onclick='plot("Acousticness")'>Acousticness</button>
<button id = "Loudness" onclick='plot("Loudness")'>Loudness</button>

<div>
</div>
<svg width=700 height=800>
</svg>
<div id = "tooltip"></div>
<script>

async function init(){
  width = 600;
  margin = 50;
  currentPlot = "Tempo";
  currentMetric = "Views";
  currentDataSize = 2000;
  changeData(currentDataSize, currentMetric);
} 

async function changeData(dataSize = 0, popularityMetric = ""){
  if(popularityMetric == "Views" || popularityMetric == "Stream" || popularityMetric == "Comments")
  {
    currentMetric = popularityMetric;
  }
  if(dataSize == -1 || dataSize == 2000 || dataSize == 500)
  {
    currentDataSize = dataSize;
  }


  if(currentDataSize == -1)
  {
    data = await d3.csv("https://chendeni.github.io/Narrative-Visualization/spotify_youtube_dataset.csv");
    if(currentMetric == "Views")
    {
          y_label = "View Count";
          y_ticks = [100, 500000000,1000000000,2000000000,4000000000,8100000000];
          //y = d3.scaleLog().domain([y_ticks[0],y_ticks[y_ticks.length - 1]]).range([width,0]);
    }
    else if(currentMetric == "Stream")
    {
          y_label = "Stream Count";
          y_ticks = [100, 500000000,1000000000,2000000000,3400000000];
          //y = d3.scaleLog().domain([y_ticks[0],y_ticks[y_ticks.length - 1]]).range([width,0]);
    }
  }
  else if(currentDataSize == 2000)
  {
    if(currentMetric == "Views")
    {
          y_label = "View Count";
          data = await d3.csv("https://chendeni.github.io/Narrative-Visualization/spotify_youtube_dataset_most_viewed.csv");
          y_ticks = [230000000, 500000000,1000000000,2000000000,4000000000,8100000000];
    }
    else if(currentMetric == "Stream")
    {
          y_label = "Stream Count";
          data = await d3.csv("https://chendeni.github.io/Narrative-Visualization/spotify_youtube_dataset_most_streamed.csv");
          y_ticks = [340000000, 500000000,1000000000,2000000000,3400000000];

    }
    
  }
  y = d3.scaleLog().domain([y_ticks[0],y_ticks[y_ticks.length - 1]]).range([width,0]);
  plot(currentPlot);


}

  
async function plot(plotName){
  currentPlot = plotName;
  switch(plotName)
  {
    case "Tempo":
      displayScatterplot("Tempo", [50,200], [50,100,150,200], "Tempo (BPM)",".0f", "log");
      break;
    case "Duration":
      if(currentDataSize == -1)
      {
        displayScatterplot("Duration_ms", [40000,700000], [40000,100000,200000,400000,700000],"Duration (seconds)", "~s", "log");
      }
      else
      {
        displayScatterplot("Duration_ms", [100000,700000], [100000,200000,400000,700000],"Duration (seconds)", "~s", "log");
      }
      break;
    case "Intensity":
      displayScatterplot("Energy", [0,1], [0,0.2,0.4,0.6,0.8,1], "Intensity", ".2f", "linear");
      break;
    case "Valence":
      displayScatterplot("Valence", [0,1], [0,0.2,0.4,0.6,0.8,1], "Valence", ".2f", "linear")
      break;
    case "Acousticness":
      displayScatterplot("Acousticness", [0,1], [0,0.2,0.4,0.6,0.8,1], "Acousticness", ".2f", "linear");
      break;
    case "Loudness":
      if(currentDataSize == -1)
      {
        displayScatterplot("Loudness", [-40,1], [-40,-30,-20,-10,0], "Loudness (dBFS)", ".2f", "linear");
      }
      else
      {
        displayScatterplot("Loudness", [-20,1], [-20,-15,-10,-5,0], "Loudness (dBFS)", ".2f", "linear");
      }
      break;
    default:
      displayScatterplot("Tempo", [50,200], [50,100,150,200], "Tempo (BPM)", ".2f", "log");
  }
  updateButtons();
}
  
async function updateButtons(){
  d3.selectAll("button").style("background-color", "white");
  d3.select("#"+currentPlot).style("background-color", "lightblue");
  d3.select("#"+currentMetric).style("background-color", "lightblue");
  if(currentDataSize == -1)
  {
    d3.select("#Full").style("background-color", "lightblue");
  }
  else if(currentDataSize == 2000)
  {
    d3.select("#Top2000").style("background-color", "lightblue");
  }

}
  
async function displayScatterplot(valueName, x_domain, x_ticks, x_label, x_format, scaleType) {
d3.select("svg").selectAll("g").remove();
d3.select("svg").selectAll("text").remove();

  //var maxValue = d3.max(data, function(d) { return +d[valueName]; } );
  var tooltip = d3.select("#tooltip");
  
var x;
if(scaleType == "log")
{
  x = d3.scaleLog().domain(x_domain).range([0,width]);
}
else
{
  x = d3.scaleLinear().domain(x_domain).range([0,width]);
}
//svg_coords = d3.select("svg").getBoundingClientRect();
d3.select("svg").append("g").attr("transform","translate("+margin+","+margin+")").selectAll("circle").data(data).enter().append("circle")
.attr("cx",function(d,i){return x(d[valueName]);})
.attr("cy",function(d,i){return y(d[currentMetric]);})
.attr("r",function(d,i){return 2;})
.on("mouseover", function(d,i){tooltip.style("opacity", 1).style("height", (100)+"px").style("left", (x(d[valueName])+70)+"px").style("top", (y(d[currentMetric])+210)+"px").html("Artist: "+d["Artist"]+"</br>Track: "+d["Track"]+"</br>"+y_label+": "+d[currentMetric]+"</br>"+x_label+": "+d[valueName]); d3.select(this).style("stroke", "orange").style("fill", "orange"); })
.on("mouseout", function(d,i){tooltip.style("opacity", 0).style("height", (0)+"px").html(""); d3.select(this).style("stroke", "black").style("fill", "lightblue");});
d3.select("svg").append("g").attr("transform","translate("+margin+","+margin+")").call(d3.axisLeft(y).tickValues(y_ticks).tickFormat(d3.format("~s")));

d3.select("svg").append("g").attr("transform","translate("+margin+","+(margin+width)+")").call(d3.axisBottom(x).tickValues(x_ticks).tickFormat(d3.format(x_format)));

d3.select("svg").append("text").attr("transform","translate("+(margin+(width/2))+","+((1.75*margin)+width)+")").style("text-anchor", "middle").text(x_label);
d3.select("svg").append("text").attr("transform","translate("+(0.25*margin)+","+(margin+(0.5*width))+") rotate(-90)").style("text-anchor", "middle").text(y_label);

  //d3.select("body").selectAll("p").data(data).enter().append("p").html(function(d,i){return d.Artist + maxViews;}) 
}





  
/*
async function initTempo() {
d3.select("svg").selectAll("g").remove();

//var maxViews = d3.max(data, function(d) { return +d.Views; } );
var maxTempo = d3.max(data, function(d) { return +d.Tempo; } );
//var y = d3.scaleLog().domain([230000000,maxViews]).range([width,0]);
var x = d3.scaleLog().domain([50,maxTempo]).range([0,width]);

d3.select("svg").append("g").attr("transform","translate("+50+","+50+")").selectAll("circle").data(data).enter().append("circle")
.attr("cx",function(d,i){return x(d.Tempo);})
.attr("cy",function(d,i){return y(d.Views);})
.attr("r",function(d,i){return 2;})
d3.select("svg").append("g").attr("transform","translate("+50+","+50+")").call(d3.axisLeft(y).tickValues([230000000, 500000000,1000000000,2000000000,4000000000,8100000000]).tickFormat(d3.format("~s")));

d3.select("svg").append("g").attr("transform","translate("+50+","+(50+width)+")").call(d3.axisBottom(x).tickValues([50,100,150,200]).tickFormat(d3.format("~s")));

  
//d3.select("body").selectAll("p").data(data).enter().append("p").html(function(d,i){return d.Artist + maxViews;})

  
}
  
  
async function initDuration() {
d3.select("svg").selectAll("g").remove();
var maxDuration = d3.max(data, function(d) { return +d.Duration_ms; } );
var x = d3.scaleLog().domain([100000,maxDuration]).range([0,width]);

d3.select("svg").append("g").attr("transform","translate("+50+","+50+")").selectAll("circle").data(data).enter().append("circle")
.attr("cx",function(d,i){return x(d.Duration_ms);})
.attr("cy",function(d,i){return y(d.Views);})
.attr("r",function(d,i){return 2;})
d3.select("svg").append("g").attr("transform","translate("+50+","+50+")").call(d3.axisLeft(y).tickValues([230000000, 500000000,1000000000,2000000000,4000000000,8100000000]).tickFormat(d3.format("~s")));

d3.select("svg").append("g").attr("transform","translate("+50+","+(50+width)+")").call(d3.axisBottom(x).tickValues([100000,200000,400000,700000]).tickFormat(d3.format("~s")));

}


  
async function initEnergy() {
d3.select("svg").selectAll("g").remove();
//var maxEnergy = d3.max(data, function(d) { return +d.Energy; } );
var x = d3.scaleLinear().domain([0,1]).range([0,width]);

d3.select("svg").append("g").attr("transform","translate("+50+","+50+")").selectAll("circle").data(data).enter().append("circle")
.attr("cx",function(d,i){return x(d.Energy);})
.attr("cy",function(d,i){return y(d.Views);})
.attr("r",function(d,i){return 2;})
d3.select("svg").append("g").attr("transform","translate("+50+","+50+")").call(d3.axisLeft(y).tickValues([230000000, 500000000,1000000000,2000000000,4000000000,8100000000]).tickFormat(d3.format("~s")));

d3.select("svg").append("g").attr("transform","translate("+50+","+(50+width)+")").call(d3.axisBottom(x).tickValues([0,0.2,0.4,0.6,0.8,1]).tickFormat(d3.format("~s")));

}
async function initValence() {
d3.select("svg").selectAll("g").remove();
var x = d3.scaleLinear().domain([0,1]).range([0,width]);

d3.select("svg").append("g").attr("transform","translate("+50+","+50+")").selectAll("circle").data(data).enter().append("circle")
.attr("cx",function(d,i){return x(d.Valence);})
.attr("cy",function(d,i){return y(d.Views);})
.attr("r",function(d,i){return 2;})
d3.select("svg").append("g").attr("transform","translate("+50+","+50+")").call(d3.axisLeft(y).tickValues([230000000, 500000000,1000000000,2000000000,4000000000,8100000000]).tickFormat(d3.format("~s")));

d3.select("svg").append("g").attr("transform","translate("+50+","+(50+width)+")").call(d3.axisBottom(x).tickValues([0,0.2,0.4,0.6,0.8,1]).tickFormat(d3.format("~s")));

}
  
async function initAcousticness() {
d3.select("svg").selectAll("g").remove();
var x = d3.scaleLinear().domain([0,1]).range([0,width]);

d3.select("svg").append("g").attr("transform","translate("+50+","+50+")").selectAll("circle").data(data).enter().append("circle")
.attr("cx",function(d,i){return x(d.Acousticness);})
.attr("cy",function(d,i){return y(d.Views);})
.attr("r",function(d,i){return 2;})
d3.select("svg").append("g").attr("transform","translate("+50+","+50+")").call(d3.axisLeft(y).tickValues([230000000, 500000000,1000000000,2000000000,4000000000,8100000000]).tickFormat(d3.format("~s")));

d3.select("svg").append("g").attr("transform","translate("+50+","+(50+width)+")").call(d3.axisBottom(x).tickValues([0,0.2,0.4,0.6,0.8,1]).tickFormat(d3.format("~s")));

}
*/
  
</script>
</body>
</html>
